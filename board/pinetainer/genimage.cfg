# Configuration file automatically generated by post-image Buildroot script,
# that provides the boot.vfat image
include ("boot.cfg")

image emmc.img {
	hdimage {}

	# Secondary program loader
	# (first-stage bootloader, initializes SDRAM)
	partition spl {
		in-partition-table = "no"
		image = "sunxi-spl.bin"

		# The Allwinner H6 boot ROM looks for a signature that signals
		# a SPL at this offset. See: https://linux-sunxi.org/BROM
		offset = 8192
	}

	# U-Boot proper
	# (second-stage bootloader)
	partition u-boot {
		in-partition-table = "no"
		image = "u-boot.itb"

		offset = 40K
		size = 984K
	}

	# The layout of our Foresee eMMC is as follows:
	#
	# Total user capacity: 14.45 GiB (30310400 sectors of 512 bytes)
	#
	# |--------------------------------------------| Sector 0
	# |           |                                |
	# |   1 MiB   |      SPL & U-BOOT PROPER       |
	# |           |        (variable size)         |
	# |           |                                |
	# |--------------------------------------------| Sector 2048 (1 MiB)
	# |           |                                |
	# |           |        BOOT PARTITION          |
	# |           |        (variable size)         |
	# |  128 MiB  |                                |
	# |           | LOWER OVERLAY ROOT FILESYSTEM  |
	# |           |   (variable size, read only)   |
	# |           |                                |
	# |--------------------------------------------| Sector 264192 (129 MiB)
	# |           |                                |
	# |  384 MiB  | UPPER OVERLAY ROOT FILESYSTEM  |
	# |           |         (read-write)           |
	# |           |                                | EBR at 1050624
	# |--------------------------------------------| Sector 1050625 (513 MiB + 0.5 KiB)
	# |           |                                |
	# | 207 MiB - |    RESERVED SPACE PARTITION    |
	# |   1 KiB   |         (not aligned)          |
	# |           |                                | EBR at 1474559
	# |--------------------------------------------| Sector 1474560 (720 MiB)
	# |           |                                |
	# | 13.75 GiB |    CONTAINER DATA PARTITION    |
	# |           |                                |
	# |--------------------------------------------| Sector 30310400 (14.45 GiB)

	# Boot partition, for the kernel image,
	# DTBs and bootloader configuration
	partition boot {
		partition-type = 0xC
		bootable = "true"
		image = "boot.vfat"

		offset = 1M
	}

	# The compressed read-only root filesystem.
	# It is used to store data that isn't expected
	# to change unless the system software is upgraded
	partition rootfs-ro {
		partition-type = 0x83
		image = "rootfs.squashfs"
	}

	# The read-write portion of the root filesystem.
	# It is used to store variable configuration and
	# data during the PineTainer lifetime, that is not
	# specific to an upgrade. It also serves as non-volatile
	# scratch space
	partition rootfs-rw {
		partition-type = 0x83
		size = 384M

		offset = 129M
	}

	# We add this partition to the MBR now, so that
	# genimage creates a extended partition that may
	# be useful for future expansion
	partition reserved {
		partition-type = 0x0

		size = 217054208 # 423934 sectors * 512
	}

	# Container/virtual machines data
	partition container-data {
		partition-type = 0x8E

		size = 14763950080 # 28835840 sectors * 512
	}
}
